# Ensure GITHUB_TOKEN is set, loading from 1Password if needed
# Usage: ensure-github-token && some-command-that-needs-token

ensure-github-token() {
    # Already set (e.g., Codespaces)
    if [[ -n "$GITHUB_TOKEN" ]]; then
        return 0
    fi

    # Check if op CLI is available
    if ! command -v op &>/dev/null; then
        echo "1Password CLI (op) not installed. Run: dotfiles/1password/install" >&2
        return 1
    fi

    # Load from 1Password (will prompt for Touch ID if needed)
    export GITHUB_TOKEN="$(op read 'op://Private/GitHub PAT/credential' 2>/dev/null)"

    if [[ -z "$GITHUB_TOKEN" ]]; then
        echo "Failed to load GITHUB_TOKEN from 1Password." >&2
        echo "Run 'rotate-github-token' to create/update the token." >&2
        return 1
    fi
}
