#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

install() {
    # Git comes pre-installed on all target systems
    :
}

check_installed() {
    command -v git &>/dev/null && [[ -L "$HOME/.gitconfig" ]]
}

configure() {
    ln -sf "$SCRIPT_DIR/.gitconfig" ~/.gitconfig
    ln -sf "$SCRIPT_DIR/.gitignore_global" ~/.gitignore_global
    ln -sfn "$SCRIPT_DIR/.git_template" ~/.git_template
    touch ~/.gitconfig-macos  # create empty file for include directive

    # Override email in Codespaces
    if [[ -n "$CODESPACES" ]]; then
        git config --global user.email "luanzeba@github.com"
    fi
}

apply() {
    # Git config is read on each command, nothing to reload
    :
}

# Main (only run when executed directly, not when sourced)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    install
    configure
fi
