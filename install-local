#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

echo 'ðŸš€ Starting local machine setup.'

# Ensure zsh is default shell (needed on Arch, not macOS)
ensure_zsh_default() {
    if [[ "$SHELL" != */zsh ]]; then
        sudo chsh -s "$(which zsh)" "$(whoami)"
    fi
}

is_arch() {
    command -v pacman &>/dev/null
}

# Main execution
echo "$(date +'%Y-%m-%d %T') - Configuring tools"
bash "$SCRIPT_DIR/git/install"
bash "$SCRIPT_DIR/tmux/install"
bash "$SCRIPT_DIR/bin/install"

echo "$(date +'%Y-%m-%d %T') - Installing languages and tools"
bash "$SCRIPT_DIR/go/install"
bash "$SCRIPT_DIR/node/install"
bash "$SCRIPT_DIR/opencode/install"

echo "$(date +'%Y-%m-%d %T') - Setting up shell"
if is_arch; then
    ensure_zsh_default
fi
zsh "$SCRIPT_DIR/zsh/install.zsh"

echo "$(date +'%Y-%m-%d %T') - Setting up editors"
zsh "$SCRIPT_DIR/nvim/install"
zsh "$SCRIPT_DIR/helix/install"

echo "$(date +'%Y-%m-%d %T') - âœ… Local setup complete!"
