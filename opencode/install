#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

check_installed() {
    command -v opencode &>/dev/null && [[ -L "$HOME/.config/opencode/opencode.json" ]]
}

# Install opencode binary
install() {
    echo "Installing opencode..."
    curl -fsSL https://opencode.ai/install | bash -s -- --no-modify-path
}

# Symlink opencode configuration
configure() {
    mkdir -p "$HOME/.config/opencode"
    ln -sf "$SCRIPT_DIR/opencode.json" "$HOME/.config/opencode/opencode.json"
}

update() {
    echo "Updating opencode..."
    curl -fsSL https://opencode.ai/install | bash -s -- --no-modify-path
}

# Main (only run when executed directly, not when sourced)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    install
    configure
fi
