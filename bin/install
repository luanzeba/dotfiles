#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

install() {
    # Scripts are part of dotfiles, nothing to install
    :
}

check_installed() {
    # Check if ~/bin exists and dotfiles script is accessible
    [[ -L "$HOME/bin" ]] || [[ -x "$HOME/bin/dotfiles" ]]
}

configure() {
    # Create dot -> dotfiles alias in the repo itself
    # This works whether ~/bin is a symlink or directory
    if [[ ! -e "$SCRIPT_DIR/dot" ]]; then
        ln -s "$SCRIPT_DIR/dotfiles" "$SCRIPT_DIR/dot"
    fi

    # Symlink bin directory to ~/bin
    if [[ ! -e "$HOME/bin" ]]; then
        ln -s "$SCRIPT_DIR" "$HOME/bin"
    elif [[ -L "$HOME/bin" ]]; then
        # Already a symlink, update it
        ln -sf "$SCRIPT_DIR" "$HOME/bin"
    else
        # ~/bin exists as a directory, symlink individual scripts
        echo "~/bin is a directory, symlinking scripts individually..."
        for script in "$SCRIPT_DIR"/*; do
            local name
            name=$(basename "$script")
            # Skip the install script itself
            [[ "$name" == "install" ]] && continue
            ln -sf "$script" "$HOME/bin/$name"
        done
    fi
}

# Main (only run when executed directly, not when sourced)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    install
    configure
fi
